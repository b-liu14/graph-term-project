<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="bookmark" href="/favicon.ico"/>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script type="text/javascript" src="js/functions.js"></script>
<script src="d3/d3.v3.min.js"></script>
</head>

<body>
<form>
    &nbsp;请选择功能：
    <select name="chooseFunction" onchange="checkField(this.selectedIndex)">
      <option value="最短路径" selected="ture">最短路径</option>
      <option value="最小生成树">最小生成树</option>
      <option value="中心度">中心度</option>
      <option value="联通分量">连通分量</option>
    </select>
  </form>
  <div class="form">
    <div id="path" style="style:block">
    
    
      起点：<input type="number" class="source" value="0" min="0" max="49" />
      终点：<input type="number" class="target" value="0" min="0" max="49" />
            <input type="button" value="确定" onclick="path_display()">
    </div>

    <div id="mst" style="display:none;">
      根节点：<input type="number" class="root" value="0" min="0" max="49" onchange="mst_display()"/>
    </div>

    <div id="centrality" style="display:none;">
      <input type="button" value="介数中心度" onclick="closeness_centrality_display()" />
      <input type="button" value="紧密中心度" onclick="closeness_centrality_display()" />
    </div>

    <div id="connected_component" style="display:none;">
           <input class="Threshold" id="Threshold" type="range" min="0" max="30" step="0.01" value="0" onchange="Threshold_changed()" />
           <input class="Threshold_input" id="Threshold_input" type="number" min="0" max="30" step="1" value="0" onchange="Threshold_input_changed()" />
    </div>
  </div>
  <div class="svg"></div>
</body>

<script>
var width = 1366,
    height = 600;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-1200)
    .linkDistance(300)
    .gravity(0.3)
    .linkStrength(0.7)
    .size([width, height]);

var svg = d3.select(".svg").append("svg")
    .attr("x", 0)
    .attr("y", -60)
    .attr("width", width)
    .attr("height", height);

//link指向实际画出来的那些边
var link;
//edges是一个二维数组，储存领接矩阵
var edges;
//node指向实际上画出来的那些点
var node;

d3.json("data/graph.json", function(error, graph) {
  if (error) throw error;

  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();

  edges = new Array(n);   //先声明一维
  for(var k=0;k<n;k++)
  { 
    edges[k]=new Array(); 
    for(var j=0;j<n;j++)
    {
      edges[k][j]=Number.POSITIVE_INFINITY;
    }
  }

  //首先加入“边”
  var n = graph.nodes.length;
  link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
      .attr("class", "link")
      //为了方便查询，此处将边的id设为source.index*n+target.index。
      //其中n为节点的size，此处为50
      .attr("id", function(d){
        //edges[parseInt(d.source.index)][parseInt(d.target.index)] = parseInt(d.weight);
        return d.source.index*n+d.target.index
      });
  link_init();

  //其次加入“点”
  node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      //将点的id设置为点的index。
      .attr("id", function(d){return d.index})
      .call(force.drag);

  
  

  node.append("title")
      .text(function(d) { return d.name; });

  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  });
});
</script>