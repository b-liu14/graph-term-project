<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="bookmark" href="/favicon.ico"/>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<script type="text/javascript" src="js/functions.js"></script>
<script src="d3/d3.v3.min.js"></script>
</head>

<body>
<form>
    &nbsp;请选择功能：
    <select name="chooseFunction" onchange="checkField(this.selectedIndex)">
      <option value="最短路径" selected="ture">最短路径</option>
      <option value="最小生成树">最小生成树</option>
      <option value="中心度">中心度</option>
      <option value="联通分量">连通分量</option>
    </select>
  </form>
  <div class="form">
    <div id="path" style="style:block">
      起点：<input type="text" class="source" value="0"/>
      终点：<input type="text" class="target" value="99"/>
            <input type="button" value="确定" onclick="path_display()">
    </div>

    <div id="mst" style="display:none;">
      根节点：<input type="text" class="source" value="0" onchange="mst_display()" />
    </div>

    <div id="centrality" style="display:none;">
      <input type="button" value="介数中心度" onclick="closeness_centrality_display()" />
      <input type="button" value="紧密中心度" onclick="closeness_centrality_display()" />
    </div>

    <div id="connected_component" style="display:none;">
            <input type="text" class="weight" value = "1" onchange="connected_component_display()"/>
    </div>
  </div>
  <div class="svg"></div>
</body>

<script>
var width = 1366,
    height = 768;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-1200)
    .linkDistance(300)
    .gravity(0.4)
    .linkStrength(0.1)
    .size([width, height]);

var svg = d3.select(".svg").append("svg")
    .attr("x", 0)
    .attr("y", -60)
    .attr("width", width)
    .attr("height", height);

var graph;
var link;
var node;
var nodes;
var links;

d3.json("data/graph.json", function(error, graph) {
  if (error) throw error;

  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();

  var n = graph.nodes.length;
  link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
      .attr("class", "link")
      //为了方便查询，此处将边的id设为source.index*n+target.index。其中n为节点的size，此处为50
      .attr("id", function(d){return d.source.index*n+d.target.index})
      .style("stroke-width", 1);

  node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      //将点的id设置为点的index。
      .attr("id", function(d){return d.index})
      .attr("r", 5)
      .style("fill", "#0000ff")
      .call(force.drag);
  nodes = node[0];
  links = link[0];

  node.append("title")
      .text(function(d) { return d.name; });

  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  });
});
</script>